@Library('jenkins-pipeline-library@latest_develop')
import no.spk.jenkins.pipeline.ci.config.CIPipelineConfig

String BUILD_IMAGE='cr.spk.no/infra/jenkins-agent-docker'

ciPipeline {
    config = CIPipelineConfig
            .getTrunkBasedConfig(trunk: 'main', useHarbor: true)
            .useMake(
                buildImage: BUILD_IMAGE,
                build: 'build-ci',
                test: 'test-ci',
                publish: 'publish-ci',
                buildContainerArgs: '-e DOCKER_HOST=${DOCKER_HOST}'
            )
            .withSonarQube()
            .withSlackNotifications(channels: 'applikasjonsplattform-ci')
}